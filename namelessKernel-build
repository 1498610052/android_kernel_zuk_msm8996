#!/bin/bash
CLANG_PATH="${HOME}/linux-x86/clang-r346389c/bin/clang"
export KBUILD_COMPILER_STRING=$($CLANG_PATH --version | head -n 1 | perl -pe 's/\(http.*?\)//gs' | sed -e 's/  */ /g' -e 's/[[:space:]]*$//')

args="-j$(nproc --all) O=out \
                      ARCH=arm64 \
                      CC=$CLANG_PATH \
                      CLANG_TRIPLE=aarch64-linux-gnu- \
                      CROSS_COMPILE=${HOME}/aarch64-linux-gnu/bin/aarch64-linux-gnu-
		      CROSS_COMPILE_ARM32=${HOME}/arm-linux-androideabi-4.9/bin/arm-linux-androideabi-";

z2_plus(){
export KBUILD_BUILD_USER="z2_plus"
export KBUILD_BUILD_HOST="LibXZR"
make $args z2_plus_defconfig&&make $args
makezip
}


z2_row(){
export KBUILD_BUILD_USER="z2_row"
export KBUILD_BUILD_HOST="LibXZR"
make $args z2_row_defconfig&&make $args
makezip
}

makezip(){
cp -f out/arch/arm64/boot/Image.gz-dtb ~/AnyKernel2
cd ~/AnyKernel2
git checkout z2/eas
zip -r "$zipname" *
cp -f "$zipname" ~
rm -f "$zipname"
}

clean(){
make mrproper
make $args mrproper
}

if [ "$1" == z2_plus ]
then
zipname="(z2_plus)Nameless Kernel[4.4-EAS] Rx.zip"
ziped=0
if [ "$2" == "mkzip" ]
then
makezip
ziped=1
fi

if [ "$2" == "menu" ]
then
make $args z2_plus_defconfig
make $args menuconfig
ziped=1
fi

if [ "$2" == "save" ]
then
make $args savedefconfig
ziped=1
fi

if [ "$2" == "regen" ]
then
make $args z2_plus_defconfig
make $args savedefconfig
mv out/defconfig arch/arm64/configs/z2_plus_defconfig
ziped=1
fi

if [ "$2" == "dirty" ]
then
z2_plus
else
if [ $ziped == 0 ]
then
clean
z2_plus
fi
fi

fi

if [ "$1" == z2_row ]
then
zipname="(z2_row)Nameless Kernel[4.4-EAS] Rx.zip"
ziped=0
if [ "$2" == "mkzip" ]
then
makezip
ziped=1
fi

if [ "$2" == "menu" ]
then
make $args z2_row_defconfig
make $args menuconfig
ziped=1
fi

if [ "$2" == "save" ]
then
make $args savedefconfig
ziped=1
fi

if [ "$2" == "regen" ]
then
make $args z2_row_defconfig
make $args savedefconfig
mv out/defconfig arch/arm64/configs/z2_row_defconfig
ziped=1
fi

if [ "$2" == "dirty" ]
then
z2_row
else
if [ $ziped == 0 ]
then
clean
z2_row
fi
fi
fi

